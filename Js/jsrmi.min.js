function Datatype(e){switch(typeof e){case"string":return e.includes("::")?e:"String::"+e;case"number":return"int::"+e;case"boolean":return"boolean::"+e;case"null":return"null";default:return"json::"+JSON.stringify(e)}}function handlefile(e){var a="",t=e.getResponseHeader("Content-Disposition");if(t&&-1!==t.indexOf("attachment")){var r=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(t);null!=r&&r[1]&&(a=r[1].replace(/['"]/g,""))}var n=window.URL.createObjectURL(e.response),s=document.createElement("a");s.href=n,s.download=a,document.body.appendChild(s),s.click()}function erlog(e,a){var t=JSON.parse(a);t.run=e,t.ErrorMsg&&showError(t.ErrorMsg)}function jsrmi(e,a){this.filename=e;var t=this;this.methodsreadback=function(e){for(var r=0;r<e.Methods.length;r++){var n=e.Methods[r].endsWith("_File");if(e.Methods[r].startsWith("Multi_")){var s=e.Methods[r].replace("Multi_","");n&&(s=s.replace("_File","")),t[s]=new Function("                    var oldcallback = arguments[arguments.length-1];                    var fun = (typeof oldcallback === 'function');                    var datagg = arguments[0];                    var data = new FormData();                    for ( var key in datagg ) {                        data.append(key, datagg[key]['$file']?datagg[key]['$file']:datagg[key]);                    }                    data.append('run','"+s+"');                    var callback = function (respdata){                        if (typeof(respdata.response)=='object') {                            handlefile(respdata);                            oldcallback(true);                        }else{                            if(respdata.responseText.length<2) return oldcallback();                            var obj = JSON.parse(respdata.responseText);                            erlog('"+s+"',respdata.responseText);                            oldcallback(obj.Return);                        }                    };                    var requset = new XMLHttpRequest();                    "+(n?"requset.responseType='blob';":"")+"                    requset.onreadystatechange = function () {                        if (requset.status == 200 && requset.readyState == 4) {                            if(fun){                                callback(requset);                            }                        }                    };                    requset.open('POST','"+t.filename+"', true);                    requset.send(data);                ")}else if(e.Methods[r].startsWith("Sync_")){s=e.Methods[r].replace("Sync_","");n&&(s=s.replace("_File","")),t[s]=new Function("                    var paras = '';                    for (var i = 0; i < arguments.length; i++){                       paras += '&para[]='+Datatype(arguments[i]);                    }                    var data = 'run="+s+"'+paras;                    var requset = new XMLHttpRequest();                    "+(n?"requset.responseType='blob';":"")+"                    requset.open('POST','"+t.filename+"', false);                    requset.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');                    requset.send(data);                    if (typeof(requset.response)=='object') {                        handlefile(requset);                        return true;                    }else{                        erlog('"+s+"',requset.responseText);                        return JSON.parse(requset.responseText).Return;                    }                ")}else{s=e.Methods[r];n&&(s=s.replace("_File","")),t[s]=new Function("                    var paras = '';                    var oldcallback = arguments[arguments.length-1];                    var fun = (typeof oldcallback === 'function');                    var callback = function (respdata){                        if (typeof(respdata.response)=='object') {                            handlefile(respdata);                            oldcallback(true);                        }else{                            if(respdata.responseText.length<2) return oldcallback();                            var obj = JSON.parse(respdata.responseText);                            erlog('"+s+"',respdata.responseText);                            oldcallback(obj.Return);                        }                    };                    if(fun){                        for (var i = 0; i < arguments.length-1; i++){                            paras += '&para[]='+Datatype(arguments[i]);                        }                    }else{                        for (var i = 0; i < arguments.length; i++){                            paras += '&para[]='+Datatype(arguments[i]);                        }                    }                    var data = 'run="+s+"'+paras;                    var requset = new XMLHttpRequest();                    "+(n?"requset.responseType='blob';":"")+"                    requset.onreadystatechange = function () {                        if (requset.status == 200 && requset.readyState == 4) {                            if(fun){                                callback(requset);                            }                        }                    };                    requset.open('POST','"+t.filename+"', true);                    requset.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');                    requset.send(data);                ")}}a&&a(t)},this.getMethods=function(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(200==e.status&&4==e.readyState){var a=e.responseText;t.methodsreadback(JSON.parse(a))}},e.open("GET",this.filename,!1),e.send()},this.getMethods()}