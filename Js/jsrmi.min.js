function Datatype(e){switch(typeof e){case"string":return e.includes("::")?e:"String::"+e;case"number":return"int::"+e;case"boolean":return"boolean::"+e;case"null":return"null";default:return"json::"+JSON.stringify(e)}}function handlefile(e){var t="",r=e.getResponseHeader("Content-Disposition");if(r&&-1!==r.indexOf("attachment")){var a=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(r);null!=a&&a[1]&&(t=a[1].replace(/['"]/g,""))}var s=window.URL.createObjectURL(e.response),n=document.createElement("a");n.href=s,n.download=t,document.body.appendChild(n),n.click()}function jsrmi(e,t){e.includes("?")&&e.includes("=")||(e="/jsrmi?Controller="+e),this.filename=e;var r=this;this.methodsreadback=function(e){for(var a=0;a<e.Methods.length;a++){var s=e.Methods[a].endsWith("_File");if(e.Methods[a].startsWith("Multi_")){var n=e.Methods[a].replace("Multi_","");s&&(n=n.replace("_File","")),r[n]=new Function("                    var data = new FormData();                    for (var i = 0; i < arguments.length; i++){                        data.append('para_'+i, arguments[i]);                    }                    data.append('para_count',arguments.length);                    data.append('run','"+n+"');                    return new Promise(function (resolve,reject){                        var callback = function (respdata){                            if (typeof(respdata.response)=='object') {                                handlefile(respdata);                                resolve(true);                            }else{                                if(respdata.responseText.length<2) return resolve();                                var obj = JSON.parse(respdata.responseText);                                if (obj.ErrorMsg) {                                    reject(obj.ErrorMsg)                                }else{                                    resolve(obj.Return);                                }                            }                        };                        var requset = new XMLHttpRequest();                        "+(s?"requset.responseType='blob';":"")+"                        requset.onreadystatechange = function () {                            if (requset.status == 200 && requset.readyState == 4) {                                callback(requset);                            }                        };                        requset.open('POST','"+r.filename+"', true);                        requset.send(data);                    });                ")}else if(e.Methods[a].startsWith("Sync_")){n=e.Methods[a].replace("Sync_","");s&&(n=n.replace("_File","")),r[n]=new Function("                    var paras = '';                    for (var i = 0; i < arguments.length; i++){                       paras += '&para[]='+Datatype(arguments[i]);                    }                    var data = 'run="+n+"'+paras;                    var requset = new XMLHttpRequest();                    "+(s?"requset.responseType='blob';":"")+"                    requset.open('POST','"+r.filename+"', false);                    requset.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');                    requset.send(data);                    if (typeof(requset.response)=='object') {                        handlefile(requset);                        return true;                    }else{                        erlog('"+n+"',requset.responseText);                        return JSON.parse(requset.responseText).Return;                    }                ")}else{n=e.Methods[a];s&&(n=n.replace("_File","")),r[n]=new Function("                    var paras = '';                    for (var i = 0; i < arguments.length; i++){                        paras += '&para[]='+Datatype(arguments[i]);                    }                    var data = 'run="+n+"'+paras;                    return new Promise(function (resolve,reject){                        var callback = function (respdata){                            if (typeof(respdata.response)=='object') {                                handlefile(respdata);                                resolve(true);                            }else{                                if(respdata.responseText.length<2) return resolve();                                var obj = JSON.parse(respdata.responseText);                                if (obj.ErrorMsg) {                                    reject(obj.ErrorMsg)                                }else{                                    resolve(obj.Return);                                }                            }                        };                        var requset = new XMLHttpRequest();                        "+(s?"requset.responseType='blob';":"")+"                        requset.onreadystatechange = function () {                            if (requset.status == 200 && requset.readyState == 4) {                                callback(requset) ;                            }                        };                        requset.open('POST','"+r.filename+"', true);                        requset.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');                        requset.send(data);                    });                ")}}t&&t(r)},this.getMethods=function(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(200==e.status&&4==e.readyState){var t=e.responseText;r.methodsreadback(JSON.parse(t))}},e.open("GET",this.filename,!1),e.send()},this.getMethods()}